#!/usr/bin/env python3

import sys

import api
import utils


# TODO GID decryption via API KBAG output

def usage(name):
    print(f'Usage: {name} <args> <stuff>')
    print('\t-b\t\tGet buildid from an iOS')
    print('\t-d\t\tDownload an ipsw')
    print('\t-k\t\tGrab Keys')
    print('\t-s\t\tSplit KBAG key')
    print('\t-x\t\tExtract IPSW')
    print('\t--baseband\tGet baseband version from an iOS')


if __name__ == '__main__':
    argv = sys.argv
    if len(argv) == 1:
        usage(argv[0])

    if len(argv) > 4:
        sys.exit('We are expecting two arguments but a max of 3!')

    if '-b' in argv:
        print(utils.iOSToBuildid(argv[2], argv[3]))  # ./yeet -b device iOS

    elif '-d' in argv:
        api.downloadIPSW(argv[2], argv[3])  # ./yeet -d device version

    elif '-k' in argv:
        api.grabKeys(argv[2], argv[3])  # ./yeet -k device version

    elif '-s' in argv:
        utils.splitKbag(argv[2])  # ./yeet -s KBAG

    elif '-x' in argv:
        utils.extractIPSW(argv[2])  # ./yeet -x IPSW

    elif '--baseband' in argv:
        print(api.getBasebandVersion(argv[2], argv[3]))  # ./yeet --baseband device version
